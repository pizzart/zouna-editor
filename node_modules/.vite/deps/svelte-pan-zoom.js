import "./chunk-Y4AOG3KG.js";

// node_modules/svelte-resize-observer-action/dist/index.js
var r = /* @__PURE__ */ new WeakMap();
var s;
function b(e, t) {
  return s = s || new ResizeObserver((i) => {
    for (let l of i) {
      let n = r.get(l.target);
      n && n(l);
    }
  }), r.set(e, t), s.observe(e), { destroy() {
    s.unobserve(e), r.delete(e);
  } };
}

// node_modules/svelte-pan-zoom/dist/index.js
var Y = (e, m) => Math.hypot(e.x - m.x, e.y - m.y);
var B = (e, m) => ({ x: (e.x + m.x) / 2, y: (e.y + m.y) / 2 });
var H = (e, m) => ({ x: e.x - m.x, y: e.y - m.y });
var N = 0.02;
var Q = 120;
function tt(e, m) {
  let p = window.devicePixelRatio, i = e.getContext("2d"), k = requestAnimationFrame, a, y, g, C, P, L, T, b2 = e.width = e.clientWidth * p, w = e.height = e.clientHeight * p, u, l = 0, r2 = { vx: 0, vy: 0, ts: 0 }, f = /* @__PURE__ */ new Map(), h = [];
  function O(t) {
    ({ width: y, height: g, render: C, padding: P, maxZoom: L, friction: T } = { padding: 0, maxZoom: 16, friction: 0.97, ...t }), a = Math.min(e.width / (y + P * p), e.height / (g + P * p)), i.resetTransform(), i.translate(e.width / 2, e.height / 2), i.scale(a, a), i.translate(-y / 2, -g / 2), _(), u = d({ x: e.width / 2, y: e.height / 2 }), E();
  }
  O(m);
  let q = b(e, (t) => {
    let n = t.contentRect, o = d({ x: b2 / 2, y: w / 2 }), s2 = i.getTransform();
    b2 = n.width * p, w = n.height * p, e.width = b2, e.height = w, a = Math.min(e.width / (m.width + P * p), e.height / (m.height + P * p)), i.setTransform(s2), u = d({ x: b2 / 2, y: w / 2 }), i.translate(u.x - o.x, u.y - o.y), l || z(performance.now());
  });
  function A(t) {
    for (; h.length && t - h[0].t > Q; )
      h.shift();
  }
  function K(t) {
    let n = performance.now();
    A(n), h.push({ point: t, t: n });
  }
  function _() {
    l && (cancelAnimationFrame(l), l = 0), r2.vx = 0, r2.vy = 0, h.length = 0;
  }
  function S() {
    let t = d({ x: 0, y: 0 }), n = d({ x: e.width, y: e.height });
    t.x > y && (i.translate(t.x - y, 0), r2.vx = -r2.vx), t.y > g && (i.translate(0, t.y - g), r2.vy = -r2.vy), n.x < 0 && (i.translate(n.x, 0), r2.vx = -r2.vx), n.y < 0 && (i.translate(0, n.y), r2.vy = -r2.vy);
  }
  function F(t) {
    t.stopPropagation(), e.setPointerCapture(t.pointerId);
    let n = R(t);
    f.set(t.pointerId, n), _();
  }
  function v(t) {
    if (t.stopPropagation(), e.releasePointerCapture(t.pointerId), f.delete(t.pointerId), f.size === 0 && (A(performance.now()), h.length > 1)) {
      let n = h[0], o = h[h.length - 1], s2 = o.point.x - n.point.x, c = o.point.y - n.point.y, x = o.t - n.t;
      r2 = { vx: s2 / x, vy: c / x, ts: performance.now() }, E();
    }
  }
  function D(t) {
    if (t.stopPropagation(), !f.has(t.pointerId))
      return;
    let n = R(t);
    switch (f.size) {
      case 1: {
        let o = d(n);
        K(o);
        let s2 = f.get(t.pointerId), c = H(o, d(s2));
        u = o, M(c), E(), f.set(t.pointerId, n);
        break;
      }
      case 2: {
        let o = [...f.values()], s2 = d(o[0]), c = d(o[1]), x = B(s2, c), U = Y(s2, c);
        f.set(t.pointerId, n), o = [...f.values()], s2 = d(o[0]), c = d(o[1]);
        let W = B(s2, c), X = Y(s2, c), j = H(W, x);
        M(j);
        let G = X / U;
        V(W, G);
        break;
      }
    }
  }
  function Z(t) {
    t.preventDefault(), t.stopPropagation();
    let n = R(t), o = Math.exp(-t.deltaY / 512);
    V(d(n), o);
  }
  function M(t) {
    i.translate(t.x, t.y), S();
  }
  function V(t, n) {
    function o(c) {
      i.translate(t.x, t.y), i.scale(c, c), i.translate(-t.x, -t.y);
    }
    o(n);
    let s2 = i.getTransform();
    s2.a < a && o(a / s2.a), s2.a > L && o(L / s2.a), u = t, E();
  }
  function R(t) {
    return { x: t.offsetX * p, y: t.offsetY * p };
  }
  function d(t) {
    return i.getTransform().inverse().transformPoint(t);
  }
  function E() {
    l || (l = k(z));
  }
  function z(t) {
    i.save(), i.resetTransform(), i.clearRect(0, 0, e.width, e.height), i.restore();
    let n = C(i, t, u), o = Math.abs(r2.vx) > N || Math.abs(r2.vy) > N;
    if (o) {
      let s2 = t - r2.ts, c = r2.vx * s2, x = r2.vy * s2;
      M({ x: c, y: x }), r2.vx *= T, r2.vy *= T, r2.ts = t;
    }
    o || n ? l = k(z) : l = 0;
  }
  let I = { passive: true };
  return e.addEventListener("pointerdown", F, I), e.addEventListener("pointerup", v, I), e.addEventListener("pointercancel", v, I), e.addEventListener("pointermove", D, I), e.addEventListener("wheel", Z), { update(t) {
    O(t);
  }, destroy() {
    q.destroy(), e.removeEventListener("pointerdown", F), e.removeEventListener("pointerup", v), e.removeEventListener("pointercancel", v), e.removeEventListener("pointermove", D), e.removeEventListener("wheel", Z);
  } };
}
export {
  tt as panzoom
};
//# sourceMappingURL=svelte-pan-zoom.js.map
